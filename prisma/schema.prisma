
generator client {
  provider = "prisma-client-js"
  output  = "../node_modules/.prisma/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL") 
}



// ------–†–æ–ª–∏------------
enum Role {
  ADMIN
  MANAGER
  EXECUTOR
  CLIENT
}


// ---------- –°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á ----------
enum TypeProjectStatus {
  NEW
  IN_PROGRESS
  REVISION
  REVIEW
  DONE
}

// ---------- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ----------
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  
  avatar    String   @default("/images/avatar-default.png")
  role      Role     @default(CLIENT)
  isEmailConfirmed Boolean @default(false)
  isBlocked Boolean @default(false)   // üîí –µ—Å–ª–∏ true ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –°–≤—è–∑–∏
  boardsAsManager Board[] @relation("ManagerBoards")
  tasksResponsible Task[] @relation("ResponsibleTasks")
  boardsAsClient  Board[] @relation("ClientBoards")
  tasksAssigned   Task[]  @relation("ExecutorTasks")
  comments        Comment[]
  refreshToken    RefreshToken?
  notifications Notification[]
}

// ---------- –î–æ—Å–∫–∞ (Board) ----------
model Board {
  id          String   @id @default(cuid())
  name        String
  clientEmail String   // email –∫–ª–∏–µ–Ω—Ç–∞
  clientId    String?  // —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
  managerId   String?
  isArchived  Boolean  @default(false)  // üì¶ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // –°–≤—è–∑–∏
  manager     User?     @relation("ManagerBoards", fields: [managerId], references: [id], onDelete: SetNull)
  client      User?    @relation("ClientBoards", fields: [clientId], references: [id], onDelete: SetNull)
  tasks       Task[]
  comments    Comment[]
}

// ---------- –ó–∞–¥–∞—á–∞ (Task) ----------
model Task {
  id           String           @id @default(cuid())
  title        String
  description  String?
  status       TypeProjectStatus @default(NEW)
  order        Int?
  boardId      String
  assignedToId String?           // –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
  responsibleId String?        // –º–µ–Ω–µ–¥–∂–µ—Ä –∫—Ç–æ —Å–æ–∑–¥–∞–ª —Å–æ–∑–¥–∞—á—É
  deadline     DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // –°–≤—è–∑–∏
  board        Board   @relation(fields: [boardId], references: [id])
  // –æ—Ç–≤–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –∑–∞–¥–∞—á—É(–º–µ–Ω–µ–¥–∂–µ—Ä)
  responsible  User? @relation("ResponsibleTasks", fields: [responsibleId], references: [id], onDelete: SetNull)
  // –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–¥–∞—á–∏ (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å)
  assignedTo   User?   @relation("ExecutorTasks", fields: [assignedToId], references: [id], onDelete: SetNull)
  comments     Comment[]
  notifications Notification[]

  // üîπ –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å order –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Å–∫–∏
  @@unique([boardId, order])
  // –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å - –¥–æ—Å–∫–∞ ,–¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å–∫–∏ –ø–æ –∑–∞–¥–∞—á–∞–º –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–µ—Ç –≤ –¥–æ—Å–∫–µ
  @@index([assignedToId, boardId])
}


// ---------- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ----------
model Comment {
  id        String   @id @default(cuid())
  text      String
  authorId  String
  boardId   String
  taskId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –°–≤—è–∑–∏
  author    User @relation(fields: [authorId], references: [id], onDelete: Cascade)
  board     Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
  task      Task? @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

// ---------- Refresh Token ----------
model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user      User @relation(fields: [userId], references: [id], onDelete: Cascade)
} 



enum NotificationType {
  NEW_COMMENT       // –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  STATUS_CHANGED    // –∏–∑–º–µ–Ω—ë–Ω —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
  ASSIGNED          // –Ω–∞–∑–Ω–∞—á–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  NEW_TASK          // —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
  SYSTEM            // —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
}

model Notification {
  id         String           @id @default(cuid())      // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  userId     String                                  // –∫–æ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  boardId    String?                                 // –¥–æ—Å–∫–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è
  taskId     String?                                 // –∑–∞–¥–∞—á–∞, –µ—Å–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫ –Ω–µ–π
  type       NotificationType                         // —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  message    String                                  // —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  meta       Json?                                   // –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä commentId, authorName)
  isRead     Boolean          @default(false)       // –ø—Ä–æ—á–∏—Ç–∞–Ω–æ/–Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–æ
  createdAt  DateTime         @default(now())       // –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)  // —Å–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
  task   Task?  @relation(fields: [taskId], references: [id], onDelete: SetNull)  // —Å–≤—è–∑—å —Å –∑–∞–¥–∞—á–µ–π

  @@index([userId, isRead])  // —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–±–æ—Ä–∫—É –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  @@index([taskId])          // —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ –∑–∞–¥–∞—á–µ
}
